{"ast":null,"code":"import _regeneratorRuntime from \"/home/square/square/square/projects/blissfull-final-project/front/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/square/square/square/projects/blissfull-final-project/front/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/square/square/square/projects/blissfull-final-project/front/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/square/square/square/projects/blissfull-final-project/front/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/square/square/square/projects/blissfull-final-project/front/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/square/square/square/projects/blissfull-final-project/front/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/square/square/square/projects/blissfull-final-project/front/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/square/square/square/projects/blissfull-final-project/front/src/ControllerCMS/Control.js\";\nimport React from 'react';\nimport { ToastContainer, toast } from \"react-toastify\";\nimport { makeRequestUrl } from \"./utils.js\";\nimport { Link } from 'react-router-dom';\n\nvar makeUrl = function makeUrl(path, params) {\n  return makeRequestUrl(\"http://localhost:5000/\".concat(path), params);\n};\n\nvar Control =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Control, _React$Component);\n\n  function Control() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Control);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Control)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      token: \"null\",\n      name: null\n    };\n\n    _this.login =\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(username, password) {\n        var url, response, answer, _answer$result, token, name;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                url = makeUrl(\"login\", {\n                  username: username,\n                  password: password,\n                  token: _this.state.token\n                });\n                _context.next = 3;\n                return fetch(url);\n\n              case 3:\n                response = _context.sent;\n                _context.next = 6;\n                return response.json();\n\n              case 6:\n                answer = _context.sent;\n\n                if (answer.success) {\n                  _answer$result = answer.result, token = _answer$result.token, name = _answer$result.name;\n\n                  _this.setState({\n                    token: token,\n                    name: name\n                  });\n\n                  toast(\"successful login\");\n                } else {\n                  toast.error(\"Incorrect username or password\");\n                }\n\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      return function (_x, _x2) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.logout =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var url, response, answer;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              url = makeUrl(\"logout\", {\n                token: _this.state.token\n              });\n              _context2.next = 3;\n              return fetch(url);\n\n            case 3:\n              response = _context2.sent;\n              _context2.next = 6;\n              return response.json();\n\n            case 6:\n              answer = _context2.sent;\n\n              if (answer.success) {\n                _this.setState({\n                  token: \"null\",\n                  name: null\n                });\n\n                toast(\"successful logout\");\n              }\n\n            case 8:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, this);\n    }));\n\n    _this.handleLogin = function (evt) {\n      evt.preventDefault();\n      var username = evt.target.username.value;\n      var password = evt.target.password.value;\n\n      _this.login(username, password);\n    };\n\n    _this.handleLogout = function () {\n      _this.logout();\n    };\n\n    _this.checkLoggedIn =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee3() {\n      var url, response, answer, message;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              url = makeUrl(\"mypage\", {\n                token: _this.state.token\n              });\n              _context3.next = 3;\n              return fetch(url);\n\n            case 3:\n              response = _context3.sent;\n              _context3.next = 6;\n              return response.json();\n\n            case 6:\n              answer = _context3.sent;\n\n              if (answer.success) {\n                message = answer.result;\n                toast(\"received from the server: '\".concat(message, \"'\"));\n              } else {\n                toast.error(\"not authorized\");\n\n                _this.logout();\n              }\n\n            case 8:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, this);\n    }));\n    return _this;\n  }\n\n  _createClass(Control, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var token = localStorage.getItem(\"token\");\n      this.setState({\n        token: token\n      });\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      localStorage.setItem(\"token\", this.state.token);\n    }\n  }, {\n    key: \"renderLogin\",\n    value: function renderLogin() {\n      return React.createElement(\"div\", {\n        className: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 92\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"myPar controlall\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 93\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 94\n        },\n        __self: this\n      }, \"Control Panel\")), React.createElement(\"form\", {\n        onSubmit: this.handleLogin,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        className: \"form-control\",\n        type: \"text\",\n        name: \"username\",\n        placeholder: \"username\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98\n        },\n        __self: this\n      }), React.createElement(\"input\", {\n        className: \"form-control\",\n        type: \"password\",\n        name: \"password\",\n        placeholder: \"password\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"linkdivs\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        type: \"submit\",\n        className: \"controllerNavigation\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112\n        },\n        __self: this\n      }, \"Login\"))), React.createElement(ToastContainer, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115\n        },\n        __self: this\n      }));\n    }\n  }, {\n    key: \"renderControl\",\n    value: function renderControl() {\n      return React.createElement(\"div\", {\n        className: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"myPar controlall\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 126\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 127\n        },\n        __self: this\n      }, \"Control Panel\")), React.createElement(\"div\", {\n        className: \"linkdivs\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129\n        },\n        __self: this\n      }, React.createElement(Link, {\n        className: \"controllerNavigation\",\n        to: \"/control/menuController\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130\n        },\n        __self: this\n      }, \"Menu Controller\"), React.createElement(Link, {\n        className: \"controllerNavigation\",\n        to: \"/control/blogController\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131\n        },\n        __self: this\n      }, \"blog Controller\"), React.createElement(Link, {\n        className: \"controllerNavigation\",\n        to: \"/control/usersOrders\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132\n        },\n        __self: this\n      }, \"users Orders\"), React.createElement(\"button\", {\n        className: \"controllerNavigation navbuttton\",\n        onClick: this.handleLogout,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133\n        },\n        __self: this\n      }, \"logout\")), React.createElement(ToastContainer, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137\n        },\n        __self: this\n      }));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      // const {token} = this.state.token\n      if (this.state.token === \"null\") {\n        return this.renderLogin();\n      }\n\n      return this.renderControl();\n    }\n  }]);\n\n  return Control;\n}(React.Component);\n\nexport default Control;","map":{"version":3,"sources":["/home/square/square/square/projects/blissfull-final-project/front/src/ControllerCMS/Control.js"],"names":["React","ToastContainer","toast","makeRequestUrl","Link","makeUrl","path","params","Control","state","token","name","login","username","password","url","fetch","response","json","answer","success","result","setState","error","logout","handleLogin","evt","preventDefault","target","value","handleLogout","checkLoggedIn","message","localStorage","getItem","setItem","renderLogin","renderControl","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { ToastContainer, toast } from \"react-toastify\";\nimport { makeRequestUrl } from \"./utils.js\";\nimport { Link } from 'react-router-dom'\n\n\n\nconst makeUrl = (path, params) => makeRequestUrl(`http://localhost:5000/${path}`,params)\n\nclass Control extends React.Component {\n\n\n  state = {\n\n    token:\"null\",\n    name:null\n  \n  }\n\n\n\n\n  login = async (username, password) => {\n\n      const url = makeUrl(`login`, { username, password, token: this.state.token });\n      const response = await fetch(url);\n      const answer = await response.json();\n      if (answer.success) {\n        const { token, name } = answer.result\n        this.setState({ token, name });\n        toast(`successful login`);\n      } else {\n        toast.error(`Incorrect username or password`)\n      }\n    } \n\n\n  logout = async () => {\n\n      const url = makeUrl(`logout`, { token: this.state.token });\n      const response = await fetch(url);\n      const answer = await response.json();\n      if (answer.success) {\n        this.setState({ token:\"null\", name:null });\n        toast(`successful logout`);\n      }\n  };\n\n\n  handleLogin = (evt) => {\n    evt.preventDefault();\n    const username = evt.target.username.value\n    const password = evt.target.password.value\n    this.login(username,password)\n  }\n\n  \n\n  handleLogout = () =>{\n      this.logout();\n  }\n\n\n    checkLoggedIn = async () => {\n      const url = makeUrl(`mypage`, { token: this.state.token });\n      const response = await fetch(url);\n      const answer = await response.json();\n      if (answer.success) {\n        const message = answer.result\n        toast(`received from the server: '${message}'`);\n      } else {\n        toast.error(\"not authorized\");\n        this.logout();\n        \n      }\n  }\n\n  componentDidMount(){\n    const token = localStorage.getItem(\"token\")\n    this.setState({token})\n  }\n\n  componentDidUpdate(){\n    localStorage.setItem(\"token\",this.state.token)\n  }\n\n\n\n\n  renderLogin(){\n    return (\n      <div className=\"\">\n        <div className=\"myPar controlall\">\n          <h1>Control Panel</h1>\n        </div>\n\n      <form onSubmit={this.handleLogin}>\n        <input\n            className=\"form-control\"\n            type=\"text\"\n            name=\"username\"\n            placeholder=\"username\"\n                    />\n\n          <input\n            className=\"form-control\"\n            type=\"password\"\n            name=\"password\"\n            placeholder=\"password\"\n                     />\n        <div className=\"linkdivs\">\n          <button type=\"submit\" className=\"controllerNavigation\">Login</button>\n        </div>\n        </form>\n        <ToastContainer />\n\n      </div>\n\n    )\n  }\n\n  renderControl(){\n\n    return (\n      <div className=\"\">\n        <div className=\"myPar controlall\">\n          <h1>Control Panel</h1>\n        </div>\n        <div className=\"linkdivs\">\n          <Link className=\"controllerNavigation\" to=\"/control/menuController\">Menu Controller</Link>\n          <Link className=\"controllerNavigation\" to=\"/control/blogController\">blog Controller</Link>\n          <Link className=\"controllerNavigation\" to=\"/control/usersOrders\">users Orders</Link>\n          <button className=\"controllerNavigation navbuttton\" onClick={this.handleLogout}>logout</button>\n\n\n        </div>\n        <ToastContainer />\n\n      </div>\n\n    )\n\n  }\n\n  render() {\n\n    // const {token} = this.state.token\n    if (this.state.token === \"null\"){\n      return this.renderLogin();\n    }\n    return this.renderControl();\n  }\n\n}\n\nexport default Control;"]},"metadata":{},"sourceType":"module"}